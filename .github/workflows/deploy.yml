# ðŸ“¦ GitHub Actions Workflow fÃ¼r Azure Bot Deployment mit Clean-up (LÃ¶sung B â€“ manuelle Secret-Namen)

name: Deploy LandKI Bot to Azure

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Azure Login
      uses: azure/login@v1
      with:
        client-id: ${{ secrets.MS_CLIENT_ID }}
        tenant-id: ${{ secrets.MS_TENANT_ID }}
        client-secret: ${{ secrets.MS_CLIENT_SECRET }}

    - name: Clean wwwroot before deployment (via Kudu API)
      run: |
        curl -X POST "https://landki-bot-app.scm.azurewebsites.net/api/command" \
          -H "Content-Type: application/json" \
          -d '{"command": "rm -rf site/wwwroot/*"}' \
          -u ${{ secrets.KUDU_USER }}:${{ secrets.USERPWD }}

    - name: Setup Python (optional)
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Deploy to Azure Web App
      uses: azure/webapps-deploy@v2
      with:
        app-name: landki-bot-app
        slot-name: production
        package: .

# âœ… Hinweis:
# - Secrets in GitHub mÃ¼ssen exakt so heiÃŸen: MS_CLIENT_ID, MS_CLIENT_SECRET, MS_TENANT_ID, KUDU_USER, USERPWD
# - Falls Kudu-API nicht erreichbar ist, kann der Clean-Schritt entfernt werden.
