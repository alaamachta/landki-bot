name: FTP Deployment to Azure Web App

on:
  push:
    branches:
      - main

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest

    env:
      APP_NAME: landki-bot-app-hrbtfefhgvasc5gk

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Upload files via FTP
      run: |
        echo "Hochladen von app.py, requirements.txt, runtime.txt..."
        curl -T app.py --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" "ftp://${{ secrets.FTP_SERVER }}/site/wwwroot/app.py"
        curl -T requirements.txt --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" "ftp://${{ secrets.FTP_SERVER }}/site/wwwroot/requirements.txt"
        curl -T runtime.txt --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" "ftp://${{ secrets.FTP_SERVER }}/site/wwwroot/runtime.txt"

    - name: pip install auf Kudu ausf√ºhren
      run: |
        echo "pip install auf Kudu starten..."
        curl -X POST "https://${{ env.APP_NAME }}.scm.azurewebsites.net/api/command" \
          -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
          -H "Content-Type: application/json" \
          -d '{ "command": "pip install -r site\\wwwroot\\requirements.txt" }'
